/*! searchable-option-list 2016-04-14 */

!function(a,b,c){"use strict";var d=function(a,b){this.$originalElement=a,this.options=b,this.metadata=this.$originalElement.data("sol-options")};d.prototype={SOL_OPTION_FORMAT:{type:"option",value:void 0,selected:!1,disabled:!1,label:void 0,tooltip:void 0,cssClass:""},SOL_OPTIONGROUP_FORMAT:{type:"optiongroup",label:void 0,tooltip:void 0,disabled:!1,children:void 0},DATA_KEY:"sol-element",WINDOW_EVENTS_KEY:"sol-window-events",defaults:{data:void 0,name:void 0,texts:{noItemsAvailable:"No entries found",selectAll:"Select all",selectNone:"Select none",quickDelete:"&times;",searchplaceholder:"Click here to search",loadingData:"Still loading data...",itemsSelected:"{$a} items selected"},events:{onInitialized:void 0,onRendered:void 0,onOpen:void 0,onClose:void 0,onChange:void 0,onScroll:function(){var a=this.$input.offset().top-this.config.scrollTarget.scrollTop()+this.$input.outerHeight(!1),b=this.$selectionContainer.outerHeight(!1),d=a+b,e=this.config.displayContainerAboveInput||c.documentElement.clientHeight-this.config.scrollTarget.scrollTop()<d,f=this.$innerContainer.outerWidth(!1)-parseInt(this.$selectionContainer.css("border-left-width"),10)-parseInt(this.$selectionContainer.css("border-right-width"),10);if(e?(a=this.$input.offset().top-b-this.config.scrollTarget.scrollTop()+parseInt(this.$selectionContainer.css("border-bottom-width"),10),this.$container.removeClass("sol-selection-bottom").addClass("sol-selection-top")):this.$container.removeClass("sol-selection-top").addClass("sol-selection-bottom"),"block"!==this.$innerContainer.css("display"))f=1.2*f;else{var g=e?"border-bottom-right-radius":"border-top-right-radius";this.$selectionContainer.css(g,"initial"),this.$actionButtons&&this.$actionButtons.css(g,"initial")}this.$selectionContainer.css("top",Math.floor(a)).css("left",Math.floor(this.$container.offset().left)).css("width",f),this.config.displayContainerAboveInput=e}},selectAllMaxItemsThreshold:30,showSelectAll:function(){return this.config.multiple&&this.config.selectAllMaxItemsThreshold&&this.items&&this.items.length<=this.config.selectAllMaxItemsThreshold},useBracketParameters:!1,multiple:void 0,showSelectionBelowList:!1,allowNullSelection:!1,scrollTarget:void 0,maxHeight:void 0,converter:void 0,asyncBatchSize:300,maxShow:0},init:function(){this.config=a.extend(!0,{},this.defaults,this.options,this.metadata);var c=this._getNameAttribute(),d=this;return c?("function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),this.config.multiple=this.config.multiple||this.$originalElement.attr("multiple"),this.config.scrollTarget||(this.config.scrollTarget=a(b)),this._registerWindowEventsIfNeccessary(),this._initializeUiElements(),this._initializeInputEvents(),setTimeout(function(){d._initializeData(),d.$originalElement.data(d.DATA_KEY,d).removeAttr("name").data("sol-name",c)},0),this.$originalElement.hide(),this.$container.css("visibility","initial").show(),this):void this._showErrorLabel("name attribute is required")},_getNameAttribute:function(){return this.config.name||this.$originalElement.data("sol-name")||this.$originalElement.attr("name")},_showErrorLabel:function(b){var c=a('<div style="color: red; font-weight: bold;" />').html(b);this.$container?this.$container.append(c):c.insertAfter(this.$originalElement)},_registerWindowEventsIfNeccessary:function(){b[this.WINDOW_EVENTS_KEY]||(a(c).click(function(b){var c,e=a(b.target),f=e.closest(".sol-selection-container"),g=e.closest(".sol-inner-container");g.length?c=g.first().parent(".sol-container"):f.length&&(c=f.first().parent(".sol-container")),a(".sol-active").not(c).each(function(b,c){a(c).data(d.prototype.DATA_KEY).close()})}),b[this.WINDOW_EVENTS_KEY]=!0)},_initializeUiElements:function(){var b=this;this.internalScrollWrapper=function(){a.isFunction(b.config.events.onScroll)&&b.config.events.onScroll.call(b)},this.$input=a('<input type="text"/>').attr("placeholder",this.config.texts.searchplaceholder),this.$noResultsItem=a('<div class="sol-no-results"/>').html(this.config.texts.noItemsAvailable).hide(),this.$loadingData=a('<div class="sol-loading-data"/>').html(this.config.texts.loadingData),this.$xItemsSelected=a('<div class="sol-results-count"/>'),this.$caret=a('<div class="sol-caret-container"><b class="sol-caret"/></div>').click(function(a){return b.toggle(),a.preventDefault(),!1});var c=a('<div class="sol-input-container"/>').append(this.$input);this.$innerContainer=a('<div class="sol-inner-container"/>').append(c).append(this.$caret),this.$selection=a('<div class="sol-selection"/>'),this.$selectionContainer=a('<div class="sol-selection-container"/>').append(this.$noResultsItem).append(this.$loadingData).append(this.$selection),this.$container=a('<div class="sol-container"/>').hide().data(this.DATA_KEY,this).append(this.$selectionContainer).append(this.$innerContainer).insertBefore(this.$originalElement),this.$showSelectionContainer=a('<div class="sol-current-selection"/>'),this.config.showSelectionBelowList?this.$showSelectionContainer.insertAfter(this.$innerContainer):this.$showSelectionContainer.insertBefore(this.$innerContainer),this.config.maxHeight&&this.$selection.css("max-height",this.config.maxHeight);var d=this.$originalElement.attr("class"),e=this.$originalElement.attr("style"),f=[],g=[];if(d&&d.length>0){f=d.split(/\s+/);for(var h=0;h<f.length;h++)this.$container.addClass(f[h])}if(e&&e.length>0){g=e.split(/\;/);for(var i=0;i<g.length;i++){var j=g[i].split(/\s*\:\s*/g);2===j.length&&(j[0].toLowerCase().indexOf("height")>=0?this.$innerContainer.css(j[0].trim(),j[1].trim()):this.$container.css(j[0].trim(),j[1].trim()))}}"block"!==this.$originalElement.css("display")&&this.$container.css("width",this._getActualCssPropertyValue(this.$originalElement,"width")),a.isFunction(this.config.events.onRendered)&&this.config.events.onRendered.call(this,this)},_getActualCssPropertyValue:function(a,d){var e=a.get(0),f=a.css("display");return a.css("display","none"),e.currentStyle?e.currentStyle[d]:b.getComputedStyle?c.defaultView.getComputedStyle(e,null).getPropertyValue(d):(a.css("display",f),a.css(d))},_initializeInputEvents:function(){var b=this,c=this.$input.parents("form").first();if(c&&1===c.length&&!c.data(this.WINDOW_EVENTS_KEY)){var d=function(){var d=[];c.find(".sol-option input").each(function(b,c){var e=a(c),f=e.data("sol-item").selected;e.prop("checked")!==f&&(e.prop("checked",f).trigger("sol-change",!0),d.push(e))}),d.length>0&&a.isFunction(b.config.events.onChange)&&b.config.events.onChange.call(b,b,d)};c.on("reset",function(a){d.call(b),setTimeout(function(){d.call(b)},100)}),c.data(this.WINDOW_EVENTS_KEY,!0)}this.$input.focus(function(){b.open()}).on("propertychange input",function(a){var c=!0;"propertychange"==a.type&&(c="value"==a.originalEvent.propertyName.toLowerCase()),c&&b._applySearchTermFilter()}),this.$container.on("keydown",function(c){var d=c.keyCode;if(!b.$noResultsItem.is(":visible")){var e,f,g,h=!1,i=b.$selection.find(".sol-option:visible");if(40===d||38===d){b._setKeyBoardNavigationMode(!0),e=b.$selection.find(".sol-option.keyboard-selection"),g=38===d?-1:1;var j=i.index(e)+g;0>j?j=i.length-1:j>=i.length&&(j=0),e.removeClass("keyboard-selection"),f=a(i[j]).addClass("keyboard-selection"),b.$selection.scrollTop(b.$selection.scrollTop()+f.position().top),h=!0}else b.keyboardNavigationMode===!0&&32===d&&(e=b.$selection.find(".sol-option.keyboard-selection input"),e.prop("checked",!e.prop("checked")).trigger("change"),h=!0);if(h)return c.preventDefault(),!1}}).on("keyup",function(a){var c=a.keyCode;if(27===c)b.keyboardNavigationMode===!0?b._setKeyBoardNavigationMode(!1):""===b.$input.val()?(b.$caret.trigger("click"),b.$input.trigger("blur")):b.$input.val("").trigger("input");else if(16===c||17===c||18===c||20===c)return})},_setKeyBoardNavigationMode:function(a){a?(this.keyboardNavigationMode=!0,this.$selection.addClass("sol-keyboard-navigation")):(this.keyboardNavigationMode=!1,this.$selection.find(".sol-option.keyboard-selection"),this.$selection.removeClass("sol-keyboard-navigation"),this.$selectionContainer.find(".sol-option.keyboard-selection").removeClass("keyboard-selection"),this.$selection.scrollTop(0))},_applySearchTermFilter:function(){if(this.items&&0!==this.items.length){var b=this.$input.val(),c=(b||"").toLowerCase();this.$selectionContainer.find(".sol-filtered-search").removeClass("sol-filtered-search"),this._setNoResultsItemVisible(!1),c.trim().length>0&&this._findTerms(this.items,c),a.isFunction(this.config.events.onScroll)&&this.config.events.onScroll.call(this)}},_findTerms:function(b,c){if(b&&a.isArray(b)&&0!==b.length){var d=this;this._setKeyBoardNavigationMode(!1),a.each(b,function(a,b){if("option"===b.type){var e=b.displayElement,f=(b.label+" "+b.tooltip).trim().toLowerCase();-1===f.indexOf(c)&&e.addClass("sol-filtered-search")}else{d._findTerms(b.children,c);var g=b.displayElement.find(".sol-option:not(.sol-filtered-search)");0===g.length&&b.displayElement.addClass("sol-filtered-search")}}),this._setNoResultsItemVisible(0===this.$selectionContainer.find(".sol-option:not(.sol-filtered-search)").length)}},_initializeData:function(){this.config.data?a.isFunction(this.config.data)?this.items=this._fetchDataFromFunction(this.config.data):a.isArray(this.config.data)?this.items=this._fetchDataFromArray(this.config.data):"string"==typeof this.config.data?this._loadItemsFromUrl(this.config.data):this._showErrorLabel("Unknown data type"):this.items=this._detectDataFromOriginalElement(),this.items&&this._processDataItems(this.items)},_detectDataFromOriginalElement:function(){if("select"===this.$originalElement.prop("tagName").toLowerCase()){var b=this,c=[];return a.each(this.$originalElement.children(),function(d,e){var f,g=a(e),h=g.prop("tagName").toLowerCase();"option"===h?(f=b._processSelectOption(g),f&&c.push(f)):"optgroup"===h?(f=b._processSelectOptgroup(g),f&&c.push(f)):b._showErrorLabel("Invalid element found in select: "+h+". Only option and optgroup are allowed")}),this._invokeConverterIfNeccessary(c)}if(this.$originalElement.data("sol-data")){var d=this.$originalElement.data("sol-data");return this._invokeConverterIfNeccessary(d)}this._showErrorLabel('Could not determine data from original element. Must be a select or data must be provided as data-sol-data="" attribute')},_processSelectOption:function(b){return a.extend({},this.SOL_OPTION_FORMAT,{value:b.val(),selected:b.prop("selected"),disabled:b.prop("disabled"),cssClass:b.attr("class"),label:b.html(),tooltip:b.attr("title"),element:b})},_processSelectOptgroup:function(b){var c=this,d=a.extend({},this.SOL_OPTIONGROUP_FORMAT,{label:b.attr("label"),tooltip:b.attr("title"),disabled:b.prop("disabled"),children:[]}),e=b.children("option");return a.each(e,function(b,e){var f=a(e),g=c._processSelectOption(f);d.disabled&&(g.disabled=!0),d.children.push(g)}),d},_fetchDataFromFunction:function(a){return this._invokeConverterIfNeccessary(a(this))},_fetchDataFromArray:function(a){return this._invokeConverterIfNeccessary(a)},_loadItemsFromUrl:function(b){var c=this;a.ajax(b,{success:function(a){c.items=c._invokeConverterIfNeccessary(a),c.items&&c._processDataItems(c.items)},error:function(a,d,e){c._showErrorLabel("Error loading from url "+b+": "+e)},dataType:"json"})},_invokeConverterIfNeccessary:function(b){return a.isFunction(this.config.converter)?this.config.converter.call(this,this,b):b},_processDataItems:function(b){if(!b)return void this._showErrorLabel("Data items not present. Maybe the converter did not return any values");if(0===b.length)return this._setNoResultsItemVisible(!0),void this.$loadingData.remove();var c=this,d=0,e=function(){this.$loadingData.remove(),this._initializeSelectAll(),a.isFunction(this.config.events.onInitialized)&&this.config.events.onInitialized.call(this,this,b)},f=function(){for(var a,g=0;g++<c.config.asyncBatchSize&&d<b.length;)if(a=b[d++],a.type===c.SOL_OPTION_FORMAT.type)c._renderOption(a);else{if(a.type!==c.SOL_OPTIONGROUP_FORMAT.type)return void c._showErrorLabel("Invalid item type found "+a.type);c._renderOptiongroup(a)}d>=b.length?e.call(c):setTimeout(f,0)};f.call(this)},_renderOption:function(b,c){var d,e,f,g=this,h=c||this.$selection,i=a('<div class="sol-label-text"/>').html(0===b.label.trim().length?"&nbsp;":b.label).addClass(b.cssClass),j=this._getNameAttribute();this.config.multiple?(d=a('<input type="checkbox" class="sol-checkbox"/>'),this.config.useBracketParameters&&(j+="[]")):d=a('<input type="radio" class="sol-radio"/>').on("change",function(){g.$selectionContainer.find('input[type="radio"][name="'+j+'"]').not(a(this)).trigger("sol-deselect")}).on("sol-deselect",function(){g._removeSelectionDisplayItem(a(this))}),d.on("change",function(b,c){a(this).trigger("sol-change",c)}).on("sol-change",function(b,c){g._selectionChange(a(this),c)}).data("sol-item",b).prop("checked",b.selected).prop("disabled",b.disabled).attr("name",j).val(b.value),e=a('<label class="sol-label"/>').attr("title",b.tooltip).append(d).append(i),f=a('<div class="sol-option"/>').append(e),b.displayElement=f,h.append(f),b.selected&&this._addSelectionDisplayItem(d)},_renderOptiongroup:function(b){var c=this,d=a('<div class="sol-optiongroup-label"/>').attr("title",b.tooltip).html(b.label),e=a('<div class="sol-optiongroup"/>').append(d);b.disabled&&e.addClass("disabled"),a.isArray(b.children)&&a.each(b.children,function(a,b){c._renderOption(b,e)}),b.displayElement=e,this.$selection.append(e)},_initializeSelectAll:function(){if(this.config.showSelectAll===!0||a.isFunction(this.config.showSelectAll)&&this.config.showSelectAll.call(this)){var b=this,c=a('<a href="#" class="sol-deselect-all"/>').html(this.config.texts.selectNone).click(function(a){return b.deselectAll(),a.preventDefault(),!1}),d=a('<a href="#" class="sol-select-all"/>').html(this.config.texts.selectAll).click(function(a){return b.selectAll(),a.preventDefault(),!1});this.$actionButtons=a('<div class="sol-action-buttons"/>').append(d).append(c).append('<div class="sol-clearfix"/>'),this.$selectionContainer.prepend(this.$actionButtons)}},_selectionChange:function(b,c){if(this.$originalElement&&"select"===this.$originalElement.prop("tagName").toLowerCase()){var d=this;this.$originalElement.find("option").each(function(c,e){var f=a(e);return f.val()===b.val()?(f.prop("selected",b.prop("checked")),void d.$originalElement.trigger("change")):void 0})}b.prop("checked")?this._addSelectionDisplayItem(b):this._removeSelectionDisplayItem(b),this.config.multiple?this.config.scrollTarget.trigger("scroll"):this.close();var e=this.$showSelectionContainer.children(".sol-selected-display-item");if(0!==this.config.maxShow&&e.length>this.config.maxShow){e.hide();var f=this.config.texts.itemsSelected.replace("{$a}",e.length);this.$xItemsSelected.html('<div class="sol-selected-display-item-text">'+f+"<div>"),this.$showSelectionContainer.append(this.$xItemsSelected),this.$xItemsSelected.show()}else e.show(),this.$xItemsSelected.hide();!c&&a.isFunction(this.config.events.onChange)&&this.config.events.onChange.call(this,this,b)},_addSelectionDisplayItem:function(b){var c,d=b.data("sol-item"),e=d.displaySelectionItem;e||(c=a('<span class="sol-selected-display-item-text" />').html(d.label),e=a('<div class="sol-selected-display-item"/>').append(c).attr("title",d.tooltip).appendTo(this.$showSelectionContainer),!this.config.multiple&&!this.config.allowNullSelection||b.prop("disabled")||a('<span class="sol-quick-delete"/>').html(this.config.texts.quickDelete).click(function(){b.prop("checked",!1).trigger("change")}).prependTo(e),d.displaySelectionItem=e)},_removeSelectionDisplayItem:function(a){var b=a.data("sol-item"),c=b.displaySelectionItem;c&&(c.remove(),b.displaySelectionItem=void 0)},_setNoResultsItemVisible:function(a){a?(this.$noResultsItem.show(),this.$selection.hide(),this.$actionButtons&&this.$actionButtons.hide()):(this.$noResultsItem.hide(),this.$selection.show(),this.$actionButtons&&this.$actionButtons.show())},isOpen:function(){return this.$container.hasClass("sol-active")},isClosed:function(){return!this.isOpen()},toggle:function(){this.isOpen()?this.close():this.open()},open:function(){this.isClosed()&&(this.$container.addClass("sol-active"),this.config.scrollTarget.bind("scroll",this.internalScrollWrapper).trigger("scroll"),a(b).on("resize",this.internalScrollWrapper),a.isFunction(this.config.events.onOpen)&&this.config.events.onOpen.call(this,this))},close:function(){this.isOpen()&&(this._setKeyBoardNavigationMode(!1),this.$container.removeClass("sol-active"),this.config.scrollTarget.unbind("scroll",this.internalScrollWrapper),a(b).off("resize"),this.$input.val(""),this._applySearchTermFilter(),this.config.displayContainerAboveInput=void 0,a.isFunction(this.config.events.onClose)&&this.config.events.onClose.call(this,this))},selectAll:function(){if(this.config.multiple){var b=this.$selectionContainer.find('input[type="checkbox"]:not([disabled], :checked)').prop("checked",!0).trigger("change",!0);this.close(),a.isFunction(this.config.events.onChange)&&this.config.events.onChange.call(this,this,b)}},deselectAll:function(){if(this.config.multiple){var b=this.$selectionContainer.find('input[type="checkbox"]:not([disabled]):checked').prop("checked",!1).trigger("change",!0);this.close(),a.isFunction(this.config.events.onChange)&&this.config.events.onChange.call(this,this,b)}},getSelection:function(){return this.$selection.find("input:checked")}},d.defaults=d.prototype.defaults,b.SearchableOptionList=d,a.fn.searchableOptionList=function(b){var c=[];return this.each(function(){var e=a(this),f=e.data(d.prototype.DATA_KEY);if(f)c.push(f);else{var g=new d(e,b);c.push(g),setTimeout(function(){g.init()},0)}}),1===c.length?c[0]:c}}(jQuery,window,document);
//# sourceMappingURL=sol.min.js.map