!function(t,e,i){"use strict";function s(i,s){this.element=i,this.settings=t.extend(!0,{},e.SOL.configuration,h,s),this.items=[],this.useCheckboxes=i.prop("multiple"),this.init()}e.SOL={configuration:{texts:{noItemsAvailable:"No entries found",selectAll:"Select all",selectNone:"Select none",quickDelete:"&times;"},classes:{selectAll:null,selectNone:null},useBracketParameters:!1,showSelectAll:!1,showSelection:!0,showSelectionBelowList:!1,allowNullSelection:!1}};var n="optionListCheckbox",l="_sol_provided_",o="_sol_events_",a="plugin_"+n,r={type:"option",value:"",selected:!1,disabled:!1,label:"",tooltip:""},c={type:"optiongroup",label:"",tooltip:"",disabled:!1},h={data:l,maxHeight:null,converter:null,onRendered:null};t.extend(s.prototype,{init:function(){var t=this;return this.addUiElements(),this.element.attr("name")?void this.fetchData(function(){t.registerEvents(),t.element.remove(),t.element=void 0}):void this.addErrorLabel("name Attribute is required for single selection selects")},addUiElements:function(){if(this.container=t('<div class="sol-container" />'),this.inputContainer=t('<div class="sol-input-container" />'),this.input=t('<input type="text" />'),this.caret=t('<div class="sol-caret-container"><b class="caret" /></div>'),this.selection=t('<div class="sol-selection" />'),this.noResultsItem=t('<div class="sol-no-results"></div>').html(this.settings.texts.noItemsAvailable).hide(),this.selectionContainer=t('<div class="sol-selection-container" />').append(this.noResultsItem).append(this.selection),this.settings.maxHeight&&this.selectionContainer.css("max-height",this.settings.maxHeight),this.inputContainer.append(this.input).append(this.caret).append(this.selectionContainer),this.container.append(this.inputContainer).insertBefore(this.element),this.settings.showSelection&&(this.showSelectionContainer=t('<div class="sol-current-selection" />'),this.settings.showSelectionBelowList?this.showSelectionContainer.insertAfter(this.inputContainer):this.showSelectionContainer.insertBefore(this.inputContainer)),this.settings.showSelectAll&&this.useCheckboxes){var e=this;this.deselectAllButton=t('<a href="#" class="sol-deselect-all" />').on("click",function(t){return t.preventDefault(),e.deselectAll(),!1}).html(this.settings.texts.selectNone),this.settings.classes.selectNone&&this.deselectAllButton.addClass(this.settings.classes.selectNone),this.selectAllButton=t('<a href="#" class="sol-select-all" />').on("click",function(t){return t.preventDefault(),e.selectAll(),!1}).html(this.settings.texts.selectAll),this.settings.classes.selectAll&&this.selectAllButton.addClass(this.settings.classes.selectAll),this.actionButtons=t('<div class="sol-action-buttons" />').append(this.selectAllButton).append(this.deselectAllButton).append('<div class="sol-clearfix"></div>'),this.selectionContainer.prepend(this.actionButtons)}this.input.css("width",Math.max(this.input.outerWidth(!1),t(this.element).outerWidth(!1))),t.isFunction(this.settings.onRendered)&&this.settings.onRendered.call(this)},fetchData:function(e){var i=this,s=!0;this.settings.data===l?this.items=this.getDataFromSelectElement():t.isFunction(this.settings.data)?this.items=this.settings.data(this):t.isArray(this.settings.data)?this.items=this.settings.data:"string"==typeof this.settings.data?(s=!1,t.ajax(this.settings.data,{success:function(t){i.items=t,i.postProcessDataAndRender(),e()}})):(this.addErrorLabel("Invalid data type"),s=!1),s&&(this.postProcessDataAndRender(),e())},postProcessDataAndRender:function(){t.isFunction(this.settings.converter)&&(this.items=this.settings.converter(this.items)),this.renderData()},renderData:function(){var e=this;return this.items?0===this.items.length?void this.noResultsItem.show():void t.each(this.items,function(t,i){"option"===i.type?e.renderOption(t,i,e.selection):e.renderOptionGroup(t,i,e.selection)}):void this.addErrorLabel("Data items not set. Maybe the converter did not return any values")},getDataFromSelectElement:function(){var e=[],i=this;return t.each(this.element.children(),function(s,n){var l,o=t(n),a=o.prop("tagName").toLowerCase();"option"===a?(l=i.onHtmlOption(s,o),l&&(l.element=o,e.push(l))):"optgroup"===a?(l=i.onHtmlOptionGroup(s,o),l&&e.push(l)):i.addErrorLabel("Invalid element found in select: "+a+". Only option and optiongroup are allowed")}),e},applySearch:function(){if(this.items&&0!==this.items.length){var t=this.input.val(),e=(t||"").toLowerCase();this.selectionContainer.find(".sol-filtered-search").removeClass("sol-filtered-search"),this.noResultsItem.hide(),t&&t.trim().length>0&&this.findTerms(this.items,e)}},findTerms:function(e,i){if(e&&t.isArray(e)&&0!==e.length){var s=this;t.each(e,function(t,e){if("option"===e.type){var n=e.displayElement,l=(e.label+" "+e.tooltip).trim().toLowerCase();-1===l.indexOf(i)&&n.addClass("sol-filtered-search")}else{s.findTerms(e.children,i);var o=e.displayElement.find(".sol-option:not(.sol-filtered-search)");0===o.length&&e.displayElement.addClass("sol-filtered-search")}}),0===this.selectionContainer.find(".sol-option:not(.sol-filtered-search)").length?this.noResultsItem.show():this.noResultsItem.hide()}},registerEvents:function(){var s=this;e[o]||(t(i).on("click",function(e){var i=t(e.target).closest(".sol-container"),s=i.first();i.length?t(".sol-container.active").not(s).each(function(e,i){t(i).removeClass("active").find('input[type="text"]').val("").trigger("keyup")}):t(".sol-container.active").removeClass("active").find('input[type="text"]').val("").trigger("keyup")}),e[o]=(new Date).getTime()),t.data(this.element,o)||(this.caret.on("click",function(){s.container.toggleClass("active")}),this.input.on("focus",function(){s.container.addClass("active")}).on("keyup",function(t){var e=t.keyCode;27===e&&s.input.val(""),16!==e&&17!==e&&18!==e&&20!==e&&s.applySearch()}),t.data(this.element,o,(new Date).getTime()))},onHtmlOption:function(e,i){return t.extend({},r,{value:i.attr("value"),selected:i.prop("selected"),disabled:i.prop("disabled"),label:i.html(),tooltip:i.attr("title"),element:i})},onHtmlOptionGroup:function(e,i){var s=t.extend({},c,{label:i.attr("label"),tooltip:i.attr("title"),disabled:i.prop("disabled")}),n=i.children("option"),l=this;return s.children=[],t.each(n,function(e,i){var n=t(i),o=l.onHtmlOption(e,n);o&&(s.disabled&&(o.disabled=!0),o.parent=s,s.children.push(o))}),s},renderOption:function(e,i,s){var n,l=this.element.attr("name"),o=this;this.useCheckboxes?(n=t('<input type="checkbox" class="sol-checkbox" />'),this.settings.useBracketParameters&&(l+="[]")):n=t('<input type="radio" class="sol-radio" />').on("change",function(){o.selectionContainer.find('input[type="radio"][name="'+l+'"]').not(t(this)).trigger("sol-deselect")}).on("sol-deselect",function(){var e=t(this).data("sol-item").displaySelectionItem;e&&e.remove()}),n.prop("checked",i.selected).prop("disabled",i.disabled).attr("name",l).data("sol-item",i).val(i.value);var a=t('<label class="sol-label" />').attr("title",i.tooltip).html(i.label).prepend(n),r=t('<div class="sol-option" />').append(a);i.displayElement=r,this.settings.showSelection&&(n.on("change",function(){t(this).prop("checked")?o.addSelectionDisplayItem(i,n):i.displaySelectionItem.remove()}),i.selected&&this.addSelectionDisplayItem(i,n)),s.append(r)},addSelectionDisplayItem:function(e,i){var s=t('<div class="sol-selected-display-item" />').html(e.label).attr("title",e.tooltip).appendTo(this.showSelectionContainer);(this.useCheckboxes||this.settings.allowNullSelection)&&t('<span class="sol-quick-delete" />').html(this.settings.texts.quickDelete).on("click",function(){i.prop("checked",!1),s.remove()}).prependTo(s),e.displaySelectionItem=s},renderOptionGroup:function(e,i,s,n){var l=t('<div class="sol-optiongroup-label">').attr("title",i.tooltip).html(i.label),o=t('<div class="sol-optiongroup" />').append(l),a=this;i.disabled&&o.addClass("disabled"),t.isArray(i.children)&&t.each(i.children,function(t,e){a.renderOption(t,e,o,n)}),i.displayElement=o,s.append(o)},selectAll:function(){this.selectionContainer.find('input[type="checkbox"]:not([disabled], :checked)').prop("checked",!0).trigger("change")},deselectAll:function(){this.selectionContainer.find('input[type="checkbox"]:not([disabled]):checked').prop("checked",!1).trigger("change")},getSelection:function(){return this.element.find("option:selected")},addErrorLabel:function(e){this.container?this.container.append(t('<div style="color: red; font-weight: bold;" />').html(e)):alert("Error: this.container not set yet. This is a bug in the plugin and needs to be fixed")}}),t.fn.searchableOptionList=function(e){return 1===this.length?(t.data(this,a)||t.data(this,a,new s(t(this),e)),t.data(this,a)):this.each(function(){t.data(this,a)||t.data(this,a,new s(t(this),e))})}}(jQuery,window,document);
